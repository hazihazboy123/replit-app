{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header">
                <h1 class="card-title mb-0">
                    <i class="bi bi-file-earmark-code me-2"></i>
                    Convert Medical JSON Flashcards to Anki Deck
                </h1>
            </div>
            <div class="card-body">
                <p class="card-text">
                    Upload a JSON file or paste JSON data containing your medical flashcards to generate a downloadable Anki deck (.apkg file) with advanced features like high-yield highlighting, cloze deletions, and hierarchical tags.
                </p>

                <form method="POST" action="{{ url_for('process_flashcards') }}" enctype="multipart/form-data" id="flashcard-form">
                    <div class="mb-4">
                        <label for="json_file" class="form-label">
                            <i class="bi bi-file-earmark-arrow-up me-1"></i>
                            Upload JSON File
                        </label>
                        <input type="file" class="form-control" id="json_file" name="json_file" accept=".json">
                        <div class="form-text">Select a .json file containing your flashcard data</div>
                    </div>

                    <div class="text-center my-3">
                        <span class="badge bg-secondary">OR</span>
                    </div>

                    <div class="mb-4">
                        <label for="json_text" class="form-label">
                            <i class="bi bi-code-square me-1"></i>
                            Paste JSON Data
                        </label>
                        <textarea class="form-control" id="json_text" name="json_text" rows="10" placeholder="Paste your JSON flashcard data here..."></textarea>
                        <div class="form-text">Enter your flashcard data in JSON format</div>
                        <button type="button" class="btn btn-outline-secondary btn-sm mt-2" id="loadSampleBtn">
                            <i class="bi bi-clipboard me-1"></i>Load Sample Data
                        </button>
                    </div>

                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="bi bi-download me-2"></i>
                            Generate Anki Deck
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-header">
                <h2 class="card-title h5 mb-0">
                    <i class="bi bi-info-circle me-2"></i>
                    JSON Format Guide
                </h2>
            </div>
            <div class="card-body">
                <p>Your JSON data should follow this structure for medical flashcards:</p>
                <pre class="bg-dark p-3 rounded"><code>{
  "deck_name": "Medical Terminology Deck",
  "cards": [
    {
      "question": "What is the mechanism of action of &lt;span class='highlight-red'&gt;Aspirin&lt;/span&gt;?",
      "answer": "Irreversibly inhibits COX-1 and COX-2 enzymes",
      "notes": "Important for cardiology and pain management",
      "tags": "Pharmacology::NSAIDs::Aspirin",
      "image": ""
    },
    {
      "cloze_text": "{% raw %}{{c1::Myocardial infarction}}{% endraw %} is caused by {% raw %}{{c2::coronary artery occlusion}}{% endraw %}",
      "notes": "Key concept for USMLE Step 1",
      "tags": "Cardiology::Pathophysiology",
      "high_yield_flag": "high-yield"
    }
  ]
}</code></pre>
                <div class="mt-3">
                    <h6>Field Options:</h6>
                    <ul class="mb-0">
                        <li><code>deck_name</code>: Name of your Anki deck (required)</li>
                        <li><code>question</code> & <code>answer</code>: For basic Q&A cards</li>
                        <li><code>cloze_text</code>: For cloze deletion cards (use {% raw %}{{c1::text}}{% endraw %} format)</li>
                        <li><code>notes</code>: Additional context shown at bottom of card (optional)</li>
                        <li><code>tags</code>: Hierarchical tags using :: separator (optional)</li>
                        <li><code>image</code>: Image filename if uploading separately (optional)</li>
                        <li><code>high_yield_flag</code>: Internal flagging field (optional)</li>
                    </ul>
                    <div class="mt-2">
                        <p><strong>Note:</strong> Each card needs either question/answer OR cloze_text</p>
                        <p><strong>Highlighting:</strong> Use HTML like <code>&lt;span class='highlight-red'&gt;text&lt;/span&gt;</code> for red highlighting</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-header">
                <h2 class="card-title h5 mb-0">
                    <i class="bi bi-question-circle me-2"></i>
                    How to Use
                </h2>
            </div>
            <div class="card-body">
                <ol class="mb-0">
                    <li>Prepare your flashcard data in the JSON format shown above</li>
                    <li>Either upload a .json file or paste the JSON data directly</li>
                    <li>Click "Generate Anki Deck" to process your data</li>
                    <li>Download the generated .apkg file</li>
                    <li>Import the .apkg file into Anki using File â†’ Import</li>
                </ol>
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-header">
                <h2 class="card-title h5 mb-0">
                    <i class="bi bi-code-slash me-2"></i>
                    API Endpoints for n8n Integration
                </h2>
            </div>
            <div class="card-body">
                <p>Use these API endpoints for programmatic access and n8n workflows:</p>
                <div class="mb-3">
                    <h6><code>POST /api/generate</code></h6>
                    <p class="mb-2">Generate Anki deck from JSON data. Send JSON in request body with <code>Content-Type: application/json</code></p>
                    <p class="mb-2"><strong>Returns:</strong> Binary .apkg file for download</p>
                </div>
                <div class="mb-3">
                    <h6><code>POST /api/validate</code></h6>
                    <p class="mb-2">Validate JSON structure without generating deck</p>
                    <p class="mb-2"><strong>Returns:</strong> JSON with validation results and card summary</p>
                </div>
                <div class="mb-3">
                    <h6><code>GET /api/schema</code></h6>
                    <p class="mb-2">Get the complete JSON schema and examples</p>
                    <p class="mb-2"><strong>Returns:</strong> JSON schema with field descriptions</p>
                </div>
                <div>
                    <h6><code>GET /api/health</code></h6>
                    <p class="mb-0">Health check endpoint for monitoring</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
