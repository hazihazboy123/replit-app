import genanki
import random
import html

# Generate unique IDs once and hardcode them for consistent deck generation
# For production, generate these once and save them.
MY_MODEL_ID = 1607392319 # A consistent example ID
MY_DECK_ID = 2059400110  # A consistent example ID

# Define the CSS for the cards, replicating AnKing styling and video appearance
MY_CARD_CSS = """
/* ANKINGMASTER NOTETYPE VERSION 8 inspired styling */

html {
    min-height: 100%;
    display: flex;
    flex-direction: column; /* Stack content vertically */
    justify-content: center; /* Center vertically */
    align-items: center;   /* Center horizontally */
    font-size: 28px; /* Base font size for desktop, as per AnKing */
}

.mobile {
    font-size: 28px; /* Base font size for mobile, as per AnKing */
}

.card {
    font-family: Arial Greek, Arial, sans-serif; /* Step exam's font is Arial Greek, as per AnKing */
    font-size: 1rem; /* Relative to html font-size */
    color: black; /* Default text color, as per AnKing */
    background-color: #D1CFCE; /* Background color, as per AnKing */
    text-align: center; /* Center align text within the card, as per video and AnKing */
    line-height: 1.6; /* Wider line spacing for readability */
    margin: 0px 15px; /* Margins, as per AnKing */
    flex-grow: 1; /* Allow card to grow and fill space */
    padding-bottom: 1em; /* Padding at the bottom, as per AnKing */
    box-sizing: border-box; /* Include padding in element's total width and height */
    max-width: 700px; /* Limit line length for readability */
}

/* Dark mode styling, as per AnKing */
.nightMode.card,.night_mode.card {
    color: #FFFAFA!important; /* Night mode text color */
    background-color: #272828!important; /* Night mode background color */
}

/* Style for the horizontal rule separating question and answer */
hr {
    border: none;
    border-top: 1px solid #ccc;
    margin: 20px 0;
}

/* Styling for cloze deletions, as per AnKing */
.cloze {
    font-weight: bold;
    color: blue; /* Cloze color */
}

.nightMode.cloze,.night_mode.cloze {
    color: #4297F9!important; /* Night mode cloze color */
}

/* Styling for the "EXTRA" field (used for Additional Notes), as per AnKing */
#extra {
    font-style: italic;
    font-size: 1rem; /* Relative to base font size */
    color: navy; /* "EXTRA" field color */
    margin-top: 25px;
    padding-top: 15px;
    border-top: 1px dashed #eee; /* Subtle separator */
    text-align: left; /* Left-align for longer notes */
}

.nightMode #extra,.night_mode #extra {
    color: magenta; /* Night mode "EXTRA" field color */
    border-top: 1px dashed #444;
}

/* Styling for mnemonics and vignettes, as per AnKing */
.mnemonic-section,.vignette-section,.clinical-correl-section,.source-section {
    margin-top: 25px;
    padding-top: 15px;
    border-top: 1px dashed #eee; /* Subtle separator */
    font-size: 0.95em; /* Slightly smaller font for supplementary info */
    color: #555;
    text-align: left; /* Mnemonics and other sections left-aligned as per AnKing */
}

.nightMode.mnemonic-section,.nightMode.vignette-section,.nightMode.clinical-correl-section,.nightMode.source-section {
    color: #aaa;
    border-top: 1px dashed #444;
}

.section-label {
    font-weight: bold;
    color: #333; /* Darker color for labels */
    margin-bottom: 5px;
    display: block; /* Ensure label is on its own line */
}

.nightMode.section-label {
    color: #ccc;
}

/* Image sizing, as per AnKing */
img {
    max-height: none; /* No max height */
}
#extra img, #lecture img, #missed img, #pathoma img, #bnb img {
    max-width: 85%; /* Max width for images in extra fields */
}
#firstaid img, #sketchy img, #physeo img, #additional img {
    max-width: 60%; /* Max width for specific resource images */
}
.mobile.card img {
    max-width: 100%!important;
}

/* TAGS container, as per AnKing */
#tags-container {
    position: fixed;
    bottom:.5px;
    width: 100%;
    line-height:.45rem;
    margin-left: -15px;
    background-color: transparent;
    display: block; /* Ensure tags are visible by default */
}
.mobile #tags-container {
    line-height: 0.6rem;
    margin-left: 0px;
    display: block; /* Ensure tags are visible on mobile */
}

/* Clickable Tags (kbd elements), as per AnKing */
kbd {
    display: inline-block;
    letter-spacing:.1px;
    font-weight: bold;
    font-size: 10px!important;
    text-shadow: none!important;
    padding: 0.05rem 0.1rem!important;
    margin: 1px -3px!important;
    border-radius: 4px;
    border-width: 1.5px!important;
    border-style: solid;
    background-color: transparent!important;
    box-shadow: none!important;
    opacity: 0.5;
    vertical-align: middle!important;
    line-height: auto!important;
    height: auto!important;
    font-family: Arial Greek, Arial; /* Font for tags */
}
kbd:hover {
    opacity: 1;
    transition: opacity 0.2s ease;
}
/* Tag Colors, as per AnKing */
kbd:nth-of-type(1n+0) { border-color: #F44336; color: #F44336!important; }
kbd:nth-of-type(2n+0) { border-color: #9C27B0; color: #9C27B0!important; }
kbd:nth-of-type(3n+0) { border-color: #3F51B5; color: #3F51B5!important; }
kbd:nth-of-type(4n+0) { border-color: #03A9F4; color: #03A9F4!important; }
kbd:nth-of-type(5n+0) { border-color: #009688; color: #009688!important; }
kbd:nth-of-type(6n+0) { border-color: #C0CA33; color: #C0CA33!important; }
kbd:nth-of-type(7n+0) { border-color: #FF9800; color: #FF9800!important;}
kbd:nth-of-type(8n+0) { border-color: #FF5722; color: #FF5722!important; }
kbd:nth-of-type(9n+0) { border-color: #9E9E9E; color: #9E9E9E!important; }
kbd:nth-of-type(10n+0) { border-color: #607D8B; color: #607D8B!important; }

.mobile kbd {
    opacity:.9;
    margin: 1px!important;
    display: inline-block;
    font-size: 10px!important;
}

/* MNEMONICS CENTER OR LEFT, as per AnKing */
.mnemonics {
    display: inline-block; /* Allows text-align:left to work within centered parent */
}
.centerbox {text-align:center;} /* Not directly used in this template, but kept for completeness */
"""

# Define the custom model (Note Type)
# This model includes all necessary fields for high-yield medical cards.
# The templates define how these fields are displayed on the front and back.
# It also embeds the custom CSS.
medical_model = genanki.Model(
    MY_MODEL_ID,
    'Medical High-Yield Card',
    fields=,
    templates=,
    css=MY_CARD_CSS
)